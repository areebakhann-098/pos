<div class="max-w-6xl mx-auto mt-10 p-6 bg-white rounded-lg shadow-lg">
  <h2 class="text-2xl font-bold mb-6 text-gray-800">
    {{ isEditMode ? 'Edit Stock Transfer' : 'Stock Transfer' }}
  </h2>

  <form (ngSubmit)="saveTransfer()" class="space-y-6">
    <!-- Reference No -->
    <div>
      <label class="block mb-2 font-medium text-gray-700">Reference No</label>
      <input type="text" [(ngModel)]="referenceNo" name="referenceNo" required
        class="w-full p-2 border border-gray-300 rounded" />
    </div>

    <!-- Date -->
    <div>
      <label class="block mb-2 font-medium text-gray-700">Date</label>
      <input type="date" [(ngModel)]="date" name="date" required
        class="w-full p-2 border border-gray-300 rounded" />
    </div>

    <!-- Locations -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block mb-2 font-medium text-gray-700">From Location</label>
        <select [(ngModel)]="fromLocation" name="fromLocation" required
          class="w-full p-2 border border-gray-300 rounded">
          <option value="">Select From Location</option>
          <option *ngFor="let loc of locations" [value]="loc.id">{{ loc.name }}</option>
        </select>
      </div>

      <div>
        <label class="block mb-2 font-medium text-gray-700">To Location</label>
        <select [(ngModel)]="toLocation" name="toLocation" required
          class="w-full p-2 border border-gray-300 rounded">
          <option value="">Select To Location</option>
          <option *ngFor="let loc of locations" [value]="loc.id">{{ loc.name }}</option>
        </select>
      </div>
    </div>

    <!-- Product Search -->
    <div class="bg-white p-4 rounded shadow-md relative">
      <label class="block mb-2 font-medium text-gray-700">Add Products</label>
      <input type="text" [(ngModel)]="searchQuery" name="search" (input)="onSearchInput()"
        placeholder="Search Product"
        class="w-full border border-gray-300 rounded px-3 py-2 text-sm" />

      <!-- Search Results Dropdown -->
      <div *ngIf="searchQuery && filteredProducts.length > 0"
        class="absolute mt-1 left-0 bg-white border rounded shadow-md w-full z-10 max-h-60 overflow-auto">
        <ul>
          <li *ngFor="let product of filteredProducts" (click)="addProduct(product)"
            class="px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm">
            {{ product.product_name || product.name }} -
            Rs. {{ product.price?.purchase_price || product.purchase_price || 0 }}
          </li>
        </ul>
      </div>

      <!-- Added Items Table -->
      <div class="overflow-x-auto mt-4">
        <table class="min-w-full border border-gray-200 rounded-lg text-sm">
          <thead class="bg-green-600 text-white">
            <tr>
              <th class="px-3 py-2">#</th>
              <th class="px-3 py-2">Product</th>
              <th class="px-3 py-2">Quantity</th>
              <th class="px-3 py-2">Price</th>
              <th class="px-3 py-2">Total</th>
              <th class="px-3 py-2">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of items; let i = index; trackBy: trackByProductId">
              <td class="px-3 py-2">{{ i + 1 }}</td>
              <td class="px-3 py-2">{{ item.name }}</td>
              <td class="px-3 py-2">
                <input type="number" [(ngModel)]="item.quantity" [name]="'qty_' + i"
                  (input)="updateLineTotal(item)"
                  class="border border-gray-300 rounded-md p-2 text-xs w-full" min="1" />
              </td>
              <td class="px-3 py-2">Rs. {{ item.price }}</td>
              <td class="px-3 py-2">Rs. {{ item.total | number: '1.2-2' }}</td>
              <td class="px-3 py-2 text-center">
                <button type="button" (click)="removeItem(item.product_id)"
                  class="text-red-600 hover:text-red-800">ðŸ—‘</button>
              </td>
            </tr>
            <tr *ngIf="items.length === 0">
              <td colspan="6" class="text-center py-3 text-gray-400">
                No products added
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="flex justify-end mt-3 text-sm">
        <div>
          <p>Total Items: <strong>{{ items.length }}</strong></p>
          <p>Grand Total:
            <strong>Rs. {{ totalAmount | number: '1.2-2' }}</strong>
          </p>
        </div>
      </div>
    </div>

    <!-- Notes -->
    <div>
      <label class="block mb-2 font-medium text-gray-700">Notes</label>
      <textarea [(ngModel)]="additionalNotes" name="notes" rows="3"
        class="w-full border rounded p-2"></textarea>
    </div>

    <!-- Shipping Charges -->
    <div>
      <label class="block mb-2 font-medium text-gray-700">Shipping Charges</label>
      <input type="number" [(ngModel)]="shippingCharges" name="shippingCharges"
        class="w-full p-2 border rounded" />
    </div>

    <!-- Save or Update -->
    <button type="submit"
      class="w-full flex items-center justify-center gap-2 bg-green-700 text-white font-semibold py-2.5 rounded-lg shadow-md hover:bg-green-800 transition-all duration-300 ease-in-out">
      {{ isEditMode ? 'Update Stock Transfer' : 'Save Stock Transfer' }}
    </button>
  </form>
</div>
