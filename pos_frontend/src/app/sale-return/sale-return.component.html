<div class="max-w-6xl mx-auto mt-10 p-6 bg-white rounded-lg shadow-lg">
  <h2 class="text-2xl font-bold mb-6 text-gray-800">ðŸ§¾ Sale Return</h2>

  <form [formGroup]="saleReturnForm" (ngSubmit)="submitSaleReturn()" class="space-y-6">
    <!-- Sale ID -->
    <div>
      <label class="block mb-2 font-medium text-gray-700">Sale ID</label>
      <input type="number" formControlName="sale_id" class="w-full p-2 border rounded" />
    </div>

    <!-- Business Location -->
    <div>
      <label class="block mb-2 font-medium text-gray-700">Business Location</label>
      <select formControlName="business_location_id" class="w-full p-2 border rounded">
        <option value="">Select Location</option>
        <option *ngFor="let loc of locations" [value]="loc.id">{{ loc.name }}</option>
      </select>
    </div>

    <!-- Reason -->
    <div>
      <label class="block mb-2 font-medium text-gray-700">Reason</label>
      <textarea formControlName="reason" rows="3" class="w-full p-2 border rounded"
        placeholder="Reason for sale return..."></textarea>
    </div>

    <!-- Product Search -->
    <div class="bg-white p-4 rounded shadow-md relative">
      <label class="block mb-2 font-medium text-gray-700">Add Products</label>
      <input type="text" formControlName="searchQuery" (input)="onSearchInput($event)"
        placeholder="Search Product" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" />

      <div *ngIf="searchFormControl.value && filteredProducts.length > 0"
        class="absolute mt-1 left-0 bg-white border rounded shadow-md w-full z-10 max-h-60 overflow-auto">
        <ul>
          <li *ngFor="let product of filteredProducts" (click)="addProduct(product)"
            class="px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm">
            {{ product.product_name || product.name }} - Rs.
            {{ product.price?.purchase_price || product.purchase_price || 0 }}
          </li>
        </ul>
      </div>

      <!-- Products Table -->
      <div class="overflow-x-auto mt-4">
        <table class="min-w-full border border-gray-200 rounded-lg text-sm">
          <thead class="bg-green-600 text-white">
            <tr>
              <th class="px-3 py-2">#</th>
              <th class="px-3 py-2">Product</th>
              <th class="px-3 py-2">Quantity</th>
              <th class="px-3 py-2">Action</th>
            </tr>
          </thead>
          <tbody formArrayName="products">
            <tr *ngFor="let productCtrl of products.controls; let i = index" [formGroupName]="i">
              <td class="px-3 py-2">{{ i + 1 }}</td>
              <td class="px-3 py-2">{{ productCtrl.get('productName')?.value }}</td>
              <td class="px-3 py-2">
                <input type="number" formControlName="quantity" min="1"
                  class="border border-gray-300 rounded-md p-2 text-xs w-full" />
              </td>
             
              <td class="px-3 py-2 text-center">
                <button type="button" (click)="removeItem(productCtrl.get('productId')?.value)"
                  class="text-red-600 hover:text-red-800">ðŸ—‘</button>
              </td>
            </tr>
            <tr *ngIf="products.length === 0">
              <td colspan="6" class="text-center py-3 text-gray-400">No products added</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

   <!-- Total Refund -->
<div>
  <label class="block mb-2 font-medium text-gray-700">Total Refund Amount</label>
  <input  type="number"
    class="w-full p-2 border rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500" />
</div>

    <button type="submit" class="w-full bg-green-600 text-white font-medium py-2 rounded hover:bg-green-700">
      Save Sale Return
    </button>
  </form>


</div>
